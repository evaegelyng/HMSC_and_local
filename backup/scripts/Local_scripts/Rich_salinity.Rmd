---
title: "Salinity plots"
author: "Eva Egelyng Sigsgaard"
date: "2023-11-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}

library(ggplot2)
library(ggpubr)
library(phyloseq)
```

```{r load data}

salinity<-read.table("../Tekstfiler/merged_metadata_230427.txt",header=TRUE)

sed_18S<-read.table("../Tekstfiler/Species_data_18S_filt_sed.tsv",row.names=1)
wat_18S<-read.table("../Tekstfiler/Species_data_18S_filt_wat.tsv",row.names=1)
sed_COI<-read.table("../Tekstfiler/species_sed_COI.txt",row.names=1)
#wat_COI<-read.table("../Tekstfiler/dataYrich_water_COI.txt",row.names=1)
wat_COI<-read.table("../Tekstfiler/Species_data_COI_filt_wat.txt",row.names=1)

#As we need to group our orders by class, we will need the taxonomic data 
COSQ_rare2<-readRDS("../RDS/COSQ_rare2_correct_score_tax.rds")
TAX_S = tax_table(COSQ_rare2)
tax <- data.frame(TAX_S,rownames=F)
tax<- tax[,c("order","class")]

#As we need to group our classes by phyla, we will need the taxonomic data 
tax_18S<-read.table("../Tekstfiler/f_tax_ncbi_5_01_22.txt", sep='\t', header=T, comment="")
tax_18S<-tax_18S[,c("Phylum","Class")]

# Add columns to metadata for matching
salinity$sed_name<-paste("sediment",salinity$season,salinity$habitat,salinity$cluster,sep="_")
salinity$wat_name<-paste("water",salinity$season,salinity$habitat,salinity$cluster,sep="_")
```

```{r sed 18S}

# Sort classes by phylum
sed_18S_t<-as.data.frame(t(sed_18S))
sed_18S_t$Phylum<-tax_18S$Phylum[match(row.names(sed_18S_t),tax_18S$Class)]
sed_18S_sort<-sed_18S_t[order(sed_18S_t$Phylum),]

# Change row names to include phylum name
sed_18S_final<-sed_18S_sort
row.names(sed_18S_final)<-paste(sed_18S_final$Phylum,row.names(sed_18S_final),sep=":")
sed_18S_final<-within(sed_18S_final,rm(Phylum))
sed_18S_final<-as.data.frame(t(sed_18S_final))

# Add salinity to richness table
sed_18S_final$salinity<-salinity$Salinity[match(row.names(sed_18S_final),salinity$sed_name)]

n<-ncol(sed_18S_final)
plots<-list()

for (i in 1:(n-1)){
  tab<-sed_18S_final[,c(i,n)]
  names(tab)[1]<-"rich"
  plot<-ggplot(tab, aes(x=salinity, y=rich)) +
  geom_point(size=1.5)+labs(title=names(sed_18S_final[i]),
       x="Salinity (ppt)", y = "MOTU richness") +
  geom_smooth() +
  theme_gray(base_size = 8) +
  theme(plot.title = element_text(size=7))
  plots[[i]]<-plot
}

# Number of plots per page
m<-9

# Number of pages needed for m plots per page
k<-ceiling(length(plots)/9)
x<-1
y<-m

for (j in 1:k){

ggsave(paste("../Plots/Scatter_rich/Salinity/Sed_18S_",j,".png",sep=""),ggarrange(plotlist=plots[x:y],ncol=3,nrow=3))
x<-y+1
y<-x+(m-1)
  
}
```

```{r wat 18S}

# Sort classes by phylum
wat_18S_t<-as.data.frame(t(wat_18S))
wat_18S_t$Phylum<-tax_18S$Phylum[match(row.names(wat_18S_t),tax_18S$Class)]
wat_18S_sort<-wat_18S_t[order(wat_18S_t$Phylum),]

# Change row names to include phylum name
wat_18S_final<-wat_18S_sort
row.names(wat_18S_final)<-paste(wat_18S_final$Phylum,row.names(wat_18S_final),sep=":")
wat_18S_final<-within(wat_18S_final,rm(Phylum))
wat_18S_final<-as.data.frame(t(wat_18S_final))

# Add salinity to richness table
wat_18S_final$salinity<-salinity$Salinity[match(row.names(wat_18S_final),salinity$wat_name)]

n<-ncol(wat_18S_final)
plots<-list()

for (i in 1:(n-1)){
  tab<-wat_18S_final[,c(i,n)]
  names(tab)[1]<-"rich"
  plot<-ggplot(tab, aes(x=salinity, y=rich)) +
  geom_point(size=1.5)+labs(title=names(wat_18S_final[i]),
       x="Salinity (ppt)", y = "MOTU richness") +
  geom_smooth() +
  theme_gray(base_size = 8)+
  theme(plot.title = element_text(size=7))
  plots[[i]]<-plot
}

# Number of plots per page
m<-9

# Number of pages needed for m plots per page
k<-ceiling(length(plots)/9)
x<-1
y<-m

for (j in 1:k){

ggsave(paste("../Plots/Scatter_rich/Salinity/Wat_18S_",j,".png",sep=""),ggarrange(plotlist=plots[x:y],ncol=3,nrow=3))
x<-y+1
y<-x+(m-1)
  
}
```

```{r sed COI}

# Sort classes by phylum
sed_COI_t<-as.data.frame(t(sed_COI))
sed_COI_t$class<-tax$class[match(row.names(sed_COI_t),tax$order)]
sed_COI_sort<-sed_COI_t[order(sed_COI_t$class),]

# Change row names to include class name
sed_COI_final<-sed_COI_sort
row.names(sed_COI_final)<-paste(sed_COI_final$class,row.names(sed_COI_final),sep=":")
sed_COI_final<-within(sed_COI_final,rm(class))
sed_COI_final<-as.data.frame(t(sed_COI_final))

# Add salinity to richness table
sed_COI_final$salinity<-salinity$Salinity[match(row.names(sed_COI_final),salinity$sed_name)]

n<-ncol(sed_COI_final)
plots<-list()

for (i in 1:(n-1)){
  tab<-sed_COI_final[,c(i,n)]
  names(tab)[1]<-"rich"
  plot<-ggplot(tab, aes(x=salinity, y=rich)) +
  geom_point(size=1.5)+labs(title=names(sed_COI_final[i]),
       x="Salinity (ppt)", y = "MOTU richness") +
  geom_smooth() +
  theme_gray(base_size = 8) +
  theme(plot.title = element_text(size=7))
  plots[[i]]<-plot
}

# Number of plots per page
m<-9

# Number of pages needed for m plots per page
k<-ceiling(length(plots)/9)
x<-1
y<-m

for (j in 1:k){

ggsave(paste("../Plots/Scatter_rich/Salinity/Sed_COI_",j,".png",sep=""),ggarrange(plotlist=plots[x:y],ncol=3,nrow=3))
x<-y+1
y<-x+(m-1)
  
}
```

```{r wat COI}

# Sort classes by phylum
wat_COI_t<-as.data.frame(t(wat_COI))
wat_COI_t$class<-tax$class[match(row.names(wat_COI_t),tax$order)]
wat_COI_sort<-wat_COI_t[order(wat_COI_t$class),]

# Change row names to include class name
wat_COI_final<-wat_COI_sort
row.names(wat_COI_final)<-paste(wat_COI_final$class,row.names(wat_COI_final),sep=":")
wat_COI_final<-within(wat_COI_final,rm(class))
wat_COI_final<-as.data.frame(t(wat_COI_final))

# Add salinity to richness table
wat_COI_final$salinity<-salinity$Salinity[match(row.names(wat_COI_final),salinity$wat_name)]

n<-ncol(wat_COI_final)
plots<-list()

for (i in 1:(n-1)){
  tab<-wat_COI_final[,c(i,n)]
  names(tab)[1]<-"rich"
  plot<-ggplot(tab, aes(x=salinity, y=rich)) +
  geom_point(size=1.5)+labs(title=names(wat_COI_final[i]),
       x="Salinity (ppt)", y = "MOTU richness") +
  geom_smooth() +
  theme_gray(base_size = 8) +
  theme(plot.title = element_text(size=7))
  plots[[i]]<-plot
}

# Number of plots per page
m<-9

# Number of pages needed for m plots per page
k<-ceiling(length(plots)/9)
x<-1
y<-m

for (j in 1:k){

ggsave(paste("../Plots/Scatter_rich/Salinity/Wat_COI_",j,".png",sep=""),ggarrange(plotlist=plots[x:y],ncol=3,nrow=3))
x<-y+1
y<-x+(m-1)
  
}
```

